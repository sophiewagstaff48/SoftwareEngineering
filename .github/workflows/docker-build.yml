# .github/workflows/docker-build.yml
name: Docker Build and Push

# Trigger only on pushes to the main branch
on: [push, pull_request]
  #push:
    #branches: [ main ] # Adjust branch name if yours is different (e.g., master)

jobs:
  build-and-push-backend:
    name: Build and Push Backend Docker Image
    runs-on: ubuntu-latest

    steps:
      - name: Check out code
        uses: actions/checkout@v4

      # Optional: Set up Docker Buildx for more advanced build features
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      #login to Docker Hub using secrets
      - name: Login to Docker Hub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}
      
      # Build and push Docker image for the backend
      - name: Build and push backend image
        uses: docker/build-push-action@v5 #t sophiewagstaff48/backend-app:latest ./backend
        with:
          content: ./backend # Path to backend Dockerfile context
          push: true # Actually push the image
          tags: ${{ secrets.DOCKERHUB_USERNAME }}/backend-app:latest # Use Docker Hub username from secrets
        # Replace 'myusername' with your Docker Hub username or another identifier
        # The tag ':latest' is common, but you could use commit SHA, etc.

build-and-push-frontend:
  name: Build and Push Frontend Docker Image
  runs-on: ubuntu-latest

  steps:
    - name: Check out code
      uses: actions/checkout@v4

    - name: Set up Docker Buildx
      uses: docker/setup-buildx-action@v3

    #Login to Docker Hub using secrets
    - name: Login to Docker Hub
      uses: docker/login-action@v3
      with:
        username: ${{ secrets.DOCKERHUB_USERNAME }}
        password: ${{ secrets.DOCKERHUB_TOKEN }}

    # Build and Push the Docker image for the frontend
    - name: Build and Push frontend image
      uses: docker/build-push-action@v5 #build -t sophiewagstaff48/frontend-app:latest ./frontend
      with:
        content: ./frontend # Path to frontend Dockerfile context
        push: true # Actually push the image
        tags: ${{ secrets.DOCKERHUB_USERNAME }}/frontend-app:latest # Use Docker Hub username from secrets
      # Replace 'myusername' with your Docker Hub username or another identifier